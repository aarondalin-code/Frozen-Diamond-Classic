<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teams • Frozen Diamond Classic</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body class="watermarkPage">
  <header class="siteHeader">
    <nav class="nav">
      <a href="./">Home</a>
      <a href="./schedule.html">Schedule/Scores</a>
      <a href="./rules.html">Rules</a>
      <a href="./teams.html" class="active">Teams</a>
      <a href="./contacts.html">Contacts</a>
      <a href="./gallery.html">Gallery</a>
      <a href="./uploads.html">Uploads</a>
     
    </nav>

    <div class="brandCenter">
      <img src="./logo.png" alt="Frozen Diamond Classic Logo" class="logoImage">
      <h1>Frozen Diamond Classic</h1>
      <div class="tagline">Tournament Central</div>
    </div>
  </header>

  <main class="wrap">
    <section class="docSection">
      <h2>Teams</h2>
      <p class="muted">Tap a team to view its roster.</p>

      <div class="card">
        <div class="cardBody">
          <div id="teamsGrid" class="teamsGrid"></div>
          <p class="muted small" style="margin-top:12px;">
            This page pulls team names from your Google Sheet “Teams” CSV.
          </p>
        </div>
      </div>
    </section>
  </main>

  <script src="./data.js"></script>

  <script>
    async function fetchCsv(url) {
      if (!url) throw new Error("Missing TEAMS_CSV_URL in data.js");
      const bust = (url.includes("?") ? "&" : "?") + "t=" + Date.now();
      const res = await fetch(url + bust, { cache: "no-store" });
      if (!res.ok) throw new Error("Failed to fetch teams CSV");
      return await res.text();
    }

    function parseCsv(text) {
      const lines = text.trim().split(/\r?\n/);
      const rows = lines.map(line => line.split(","));
      const headers = (rows.shift() || []).map(h => String(h).trim().replace(/\s+/g, ""));
      return rows
        .filter(r => r.some(x => String(x).trim() !== ""))
        .map(r => Object.fromEntries(headers.map((h, i) => [h, String(r[i] ?? "").trim()])));
    }

    function safe(v){ return String(v || "").trim(); }

    function teamSlug(name) {
      // URL-friendly identifier
      return safe(name)
        .toLowerCase()
        .replace(/&/g, "and")
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/(^-|-$)/g, "");
    }

    function renderTeams(teamRows) {
      const grid = document.getElementById("teamsGrid");
      grid.innerHTML = "";

      // Expecting headers: Seed, TeamName
      const teams = teamRows
        .map(r => ({ seed: Number(r.Seed), name: safe(r.TeamName) }))
        .filter(t => t.name)
        .sort((a,b) => (a.seed || 999) - (b.seed || 999));

      for (const t of teams) {
        const slug = teamSlug(t.name);

        const a = document.createElement("a");
        a.className = "teamTile";
        a.href = `./team.html?team=${encodeURIComponent(slug)}`;

        a.innerHTML = `
          <div class="teamTileTop">
            <div class="teamTileName">${t.name}</div>
            <div class="teamTileSeed">${Number.isFinite(t.seed) ? "Seed " + t.seed : ""}</div>
          </div>
          <div class="teamTileMeta">View roster →</div>
        `;

        grid.appendChild(a);
      }
    }

    (async function init(){
      try {
        const csv = await fetchCsv(window.SHEET?.TEAMS_CSV_URL);
        const rows = parseCsv(csv);
        renderTeams(rows);
      } catch (err) {
        console.error(err);
        alert("Teams page error: check TEAMS_CSV_URL in data.js and make sure Teams tab is published to CSV.");
      }
    })();
  </script>
</body>
</html>



