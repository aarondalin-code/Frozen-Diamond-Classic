<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Frozen Diamond Classic</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body class="watermarkPage">

  <header class="siteHeader">
    <nav class="nav">
      <a href="./" class="active">Home</a>
      <a href="./schedule.html">Schedule/Scores</a>
      <a href="./standings.html">Standings</a>
      <a href="./stats.html">Stats</a>
      <a href="./teams.html">Teams</a>
      <a href="./rules.html">Rules</a>
      <a href="./contacts.html">Contacts</a>
      <a href="./gallery.html">Gallery</a>
      <a href="./uploads.html">Uploads</a>
    </nav>

    <div class="brandCenter">
      <img src="./logo.png" alt="Frozen Diamond Classic Logo" class="logoImage">
      <h1>Frozen Diamond Classic</h1>
      <div class="tagline">Tournament Central</div>
    </div>
  </header>

  <main class="wrap">

    <!-- Countdown -->
    <section class="docSection">
      <div class="countdownCard">
        <div class="countdownLabel">Tournament Day</div>

        <!-- We keep your countdown element exactly -->
        <div id="countdown" class="countdownValue"></div>

        <!-- Champion banner (hidden until tournament complete) -->
        <div id="championBanner" class="countdownValue" style="display:none;"></div>

        <div class="muted small">Saturday, March 21, 2026</div>
      </div>
    </section>

    <section class="docSection">
      <h2>Tournament Overview</h2>
      <p>
        The Frozen Diamond Classic is a one-day 9U baseball tournament designed to provide a competitive and fun indoor
        experience during the winter. Teams are encouraged to socialize between games. All teams will play 3 games win or lose.
      </p>
    </section>

    <section class="docSection">
      <h2>Tournament Details</h2>
      <div class="card">
        <div class="cardBody">
          <ul class="bullets">
            <li><strong>Date:</strong> Saturday, March 21, 2026</li>
            <li><strong>Location:</strong> CenterCourt ‚Äì 1080 Spruce Street, Lawrence</li>
            <li>
              <a class="link" href="https://centercourtacademy.com/locations/lawrence/" target="_blank" rel="noopener">
                CenterCourt Lawrence Venue Page
              </a>
            </li>
            <li>
              <a class="link" href="https://docs.google.com/forms/d/e/1FAIpQLSdFvmyPqP_S-59jUxF18mxD0cQtGeV9ZeFhptzh0bym8pTPnQ/viewform" target="_blank" rel="noopener">
                Tournament T-Shirt Order Form
              </a>
            </li>
            <li><strong>Teams:</strong> 8 teams, invite only ‚Äî Town level A or strong B</li>
            <li><strong>Rules:</strong> Standard 9U (see Rules page)</li>
            <li><strong>Scoring:</strong> GameChanger Tournament ‚Äî ‚ÄúFrozen Diamond Classic 2026‚Äù</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="docSection">
      <h2>Participating Teams</h2>
      <div class="card">
        <div class="cardBody">
          <div class="teamsGrid">
            <a class="teamTile" href="./team.html?team=south-orange-maplewood">South Orange Maplewood</a>
            <a class="teamTile" href="./team.html?team=watchung-hills">Watchung Hills</a>
            <a class="teamTile" href="./team.html?team=branchburg">Branchburg</a>
            <a class="teamTile" href="./team.html?team=ridge">Ridge 9U Green</a>
            <a class="teamTile" href="./team.html?team=scotch-plains-fanwood">Scotch Plains Fanwood</a>
            <a class="teamTile" href="./team.html?team=hillsborough">Hillsborough</a>
            <a class="teamTile" href="./team.html?team=westfield-white">Westfield White</a>
            <a class="teamTile" href="./team.html?team=westfield-blue">Westfield Blue</a>
          </div>
        </div>
      </div>
    </section>

    <section class="docSection">
      <h2>Directions</h2>
      <div class="card">
        <div class="cardBody">

          <p class="muted small" style="margin-top:0;">
            CenterCourt ‚Äì 1080 Spruce Street, Lawrence
          </p>

          <div class="mapEmbed">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d6090.512546295843!2d-74.75651128824809!3d40.2478355657823!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c1586aed486f57%3A0xfd6b3fd60c1f1f1d!2sCentercourt%20Lawrence!5e0!3m2!1sen!2sus!4v1771091548040!5m2!1sen!2sus"
              loading="lazy"
              allowfullscreen
              referrerpolicy="no-referrer-when-downgrade">
            </iframe>
          </div>

          <p style="margin-bottom:0;">
            <a
              class="link"
              href="https://www.google.com/maps/dir/?api=1&destination=Centercourt+Lawrence"
              target="_blank"
              rel="noopener">
              Get Directions in Google Maps
            </a>
          </p>

        </div>
      </div>
    </section>

    <section class="docSection">
      <h2>Facility Information</h2>
      <div class="card">
        <div class="cardBody">
          <ul class="bullets">
            <li><strong>Climate:</strong> It can get cool ‚Äî dress appropriately (long sleeve under jersey recommended).</li>
            <li><strong>Chairs:</strong> No bleachers available ‚Äî bring your own chairs or blankets.</li>
            <li>Teams may bring coolers with snacks and drinks.</li>
            <li>Picnic-style tables available between games.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- FOOD SECTION -->
    <section class="docSection">
      <h2>Food</h2>
      <div class="card">
        <div class="cardBody">
          <ul class="bullets">
            <li>Food trucks + vending machines + water refill station available.</li>
            <li>Ruben‚Äôs Pizza ‚Äî 2191 Spruce Street ‚Äî (609) 883-6637 (delivery available)</li>
            <li>Wendy‚Äôs ‚Ä¢ Burger King ‚Ä¢ McDonald‚Äôs ‚Ä¢ WingStop ‚Ä¢ QuickChek (‚âà 5 minutes away)</li>
          </ul>
        </div>
      </div>
    </section>

  </main>

  <!-- Load your Google Sheet URLs -->
  <script src="./data.js"></script>

  <!-- Countdown Script (your original) -->
  <script>
    const targetDate = new Date("March 21, 2026 08:00:00").getTime();
    const countdownEl = document.getElementById("countdown");

    function updateCountdown() {
      const now = new Date().getTime();
      const distance = targetDate - now;

      if (distance <= 0) {
        countdownEl.innerHTML = "Tournament Day Is Here!";
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((distance / (1000 * 60)) % 60);

      countdownEl.innerHTML = `${days} Days ‚Ä¢ ${hours} Hours ‚Ä¢ ${minutes} Minutes`;
    }

    updateCountdown();
    setInterval(updateCountdown, 60000);
  </script>

  <!-- Champion Swap Script -->
  <script>
    (async function(){
      const championEl = document.getElementById("championBanner");
      const countdownEl = document.getElementById("countdown");

      function safe(v){ return String(v ?? "").trim(); }
      function isFinal(s){ return safe(s).toLowerCase() === "final"; }
      function toNum(x){ const n = Number(safe(x)); return Number.isFinite(n) ? n : null; }

      async function fetchCsv(url){
        if (!url) throw new Error("Missing CSV URL in data.js");
        const bust = (url.includes("?") ? "&" : "?") + "t=" + Date.now();
        const res = await fetch(url + bust, { cache: "no-store" });
        if (!res.ok) throw new Error(`Failed to fetch CSV (${res.status})`);
        return await res.text();
      }

      // Robust CSV parser (handles quoted commas)
      function parseCsv(text) {
        const rows = [];
        let row = [];
        let cur = "";
        let inQuotes = false;

        for (let i = 0; i < text.length; i++) {
          const ch = text[i];
          const next = text[i + 1];

          if (ch === '"') {
            if (inQuotes && next === '"') { cur += '"'; i++; }
            else inQuotes = !inQuotes;
            continue;
          }

          if (!inQuotes && ch === ",") { row.push(cur); cur = ""; continue; }

          if (!inQuotes && (ch === "\n" || ch === "\r")) {
            if (ch === "\r" && next === "\n") i++;
            row.push(cur); cur = "";
            if (row.some(v => safe(v) !== "")) rows.push(row);
            row = [];
            continue;
          }

          cur += ch;
        }

        row.push(cur);
        if (row.some(v => safe(v) !== "")) rows.push(row);

        const headers = (rows.shift() || []).map(h => safe(h).replace(/\s+/g,""));
        return rows.map(r => {
          const obj = {};
          headers.forEach((h, idx) => obj[h] = safe(r[idx]));
          return obj;
        });
      }

      function allGamesFinal(gameRows){
        const withIds = gameRows.filter(g => safe(g.Game) !== "");
        return withIds.length >= 12 && withIds.every(g =>
          isFinal(g.Status) && toNum(g.ScoreA) !== null && toNum(g.ScoreB) !== null
        );
      }

      function winnerLoser(game) {
        if (!isFinal(game.Status)) return null;
        const a = toNum(game.ScoreA);
        const b = toNum(game.ScoreB);
        if (a === null || b === null) return null;
        if (a === b) return null;
        return a > b ? { W: game.TeamA, L: game.TeamB } : { W: game.TeamB, L: game.TeamA };
      }

      // Resolve S#/W#/L# into real team names using Teams tab + prior games.
      function resolveTeamRef(ref, teamsBySeed, gamesById) {
        if (!ref) return "TBD";
        ref = safe(ref).toUpperCase();
        if (!ref) return "TBD";

        const type = ref[0];
        const num = Number(ref.slice(1));
        if (!Number.isFinite(num)) return "TBD";

        if (type === "S") return teamsBySeed.get(num) || "TBD";

        const g = gamesById.get(num);
        if (!g) return "TBD";

        const wl = winnerLoser(g);
        if (!wl) return "TBD";

        return resolveTeamRef(type === "W" ? wl.W : wl.L, teamsBySeed, gamesById);
      }

      try {
        // Need both Teams + Games to resolve refs like W5
        const [teamsText, gamesText] = await Promise.all([
          fetchCsv(window.SHEET?.TEAMS_CSV_URL),
          fetchCsv(window.SHEET?.GAMES_CSV_URL)
        ]);

        const teamRows = parseCsv(teamsText);
        const gameRows = parseCsv(gamesText);

        if (!allGamesFinal(gameRows)) return;

        const teamsBySeed = new Map(
          teamRows
            .map(r => [Number(r.Seed), safe(r.TeamName)])
            .filter(([s,n]) => Number.isFinite(s) && n)
        );

        const gamesById = new Map(
          gameRows
            .map(r => [Number(r.Game), r])
            .filter(([id]) => Number.isFinite(id))
        );

        const g12 = gamesById.get(12);
        if (!g12) return;

        const a = toNum(g12.ScoreA);
        const b = toNum(g12.ScoreB);
        if (a === null || b === null || a === b) return;

        const teamAName = resolveTeamRef(g12.TeamA, teamsBySeed, gamesById);
        const teamBName = resolveTeamRef(g12.TeamB, teamsBySeed, gamesById);

        const championName = a > b ? teamAName : teamBName;

        // Swap UI: hide countdown text, show champion banner in the same card
        if (countdownEl) countdownEl.style.display = "none";
        if (championEl){
          championEl.style.display = "block";
          championEl.innerHTML = `üèÜ Champion: ${championName}`;
        }
      } catch (e) {
        console.error(e);
        // fail silently; countdown stays
      }
    })();
  </script>

</body>
</html>

