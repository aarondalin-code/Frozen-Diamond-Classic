<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teams â€¢ Frozen Diamond Classic</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body class="watermarkPage teamsPage">
  <header class="siteHeader">
    <nav class="nav">
      <a href="./">Home</a>
      <a href="./schedule.html">Schedule/Scores</a>
      <a href="./standings.html">Standings</a>
      <a href="./stats.html">Stats</a>
      <a href="./teams.html" class="active">Teams</a>
      <a href="./rules.html">Rules</a>
      <a href="./contacts.html">Contacts</a>
      <a href="./gallery.html">Gallery</a>
      <a href="./uploads.html">Uploads</a>
    </nav>

    <div class="brandCenter">
      <img src="./logo.png" alt="Frozen Diamond Classic Logo" class="logoImage">
      <h1>Frozen Diamond Classic</h1>
      <div class="tagline">Tournament Central</div>
    </div>
  </header>

  <main class="wrap">
    <div class="liveBanner" role="status" aria-live="polite">
  <span class="liveDot" aria-hidden="true"></span>
  <span class="liveText"><strong>LIVE</strong> Tournament Central</span>
  <span class="liveMeta" id="liveUpdated"></span>
</div>

    <section class="docSection">
      <h2>Teams</h2>
      <p class="muted">Tap a team to view its roster.</p>

      <div class="card">
        <div class="cardBody">
          <div id="teamsGrid" class="teamsGrid"></div>
        </div>
      </div>
    </section>
  </main>

  <script src="./data.js"></script>

  <script>
    function safe(v){ return String(v || "").trim(); }

    async function fetchCsv(url) {
      if (!url) throw new Error("Missing CSV URL in data.js");
      const bust = (url.includes("?") ? "&" : "?") + "t=" + Date.now();
      const res = await fetch(url + bust, { cache: "no-store" });
      if (!res.ok) throw new Error("Failed to fetch CSV");
      return await res.text();
    }

    function parseCsv(text) {
      const lines = text.trim().split(/\r?\n/);
      const rows = lines.map(line => line.split(","));
      const headers = (rows.shift() || []).map(h => safe(h).replace(/\s+/g,""));
      return rows
        .filter(r => r.some(x => safe(x) !== ""))
        .map(r => Object.fromEntries(headers.map((h,i)=>[h,safe(r[i])])));
    }

    function teamSlug(name) {
      return safe(name)
        .toLowerCase()
        .replace(/&/g,"and")
        .replace(/[^a-z0-9]+/g,"-")
        .replace(/(^-|-$)/g,"");
    }

    function pickLogoForSlug(slug){
      const info = window.TEAM_INFO && window.TEAM_INFO[slug];
      return (info && info.logo) ? info.logo : (window.DEFAULT_TEAM_LOGO || "./logo.png");
    }

    function computeRecords(gameRows){
      const records = new Map();

      function ensure(team){
        if (!records.has(team)){
          records.set(team,{W:0,L:0,T:0});
        }
      }

      for (const g of gameRows){
        if (safe(g.Status).toLowerCase() !== "final") continue;

        const a = safe(g.TeamA);
        const b = safe(g.TeamB);
        const sa = Number(g.ScoreA);
        const sb = Number(g.ScoreB);

        if (!a || !b) continue;

        ensure(a);
        ensure(b);

        if (sa === sb){
          records.get(a).T++;
          records.get(b).T++;
        } else if (sa > sb){
          records.get(a).W++;
          records.get(b).L++;
        } else {
          records.get(b).W++;
          records.get(a).L++;
        }
      }

      return records;
    }

    function renderTeams(teamRows, recordMap){
      const grid = document.getElementById("teamsGrid");
      grid.innerHTML = "";

      const teams = teamRows
        .map(r => ({ seed: Number(r.Seed), name: safe(r.TeamName) }))
        .filter(t => t.name)
        .sort((a,b)=> (a.seed||999)-(b.seed||999));

      for (const t of teams){
        const slug = teamSlug(t.name);
        const logoUrl = pickLogoForSlug(slug);

        const r = recordMap.get(t.name);
        const recText = r ? `${r.W}-${r.L}-${r.T}` : "0-0-0";

        const a = document.createElement("a");
        a.className = "teamTile";
        a.href = `./team.html?team=${encodeURIComponent(slug)}`;

        a.innerHTML = `
          <span class="teamAccent"></span>

          <div class="teamTileCenter">
            <img class="teamTileLogo"
                 src="${logoUrl}"
                 alt="${t.name} logo"
                 onerror="this.onerror=null; this.src='./logo.png';">

            <div class="teamName">${t.name}</div>

            <div class="teamRecord">${recText}</div>
          </div>
        `;

        grid.appendChild(a);
      }
    }

    (async function init(){
      try{
        const teamsCsv = await fetchCsv(window.SHEET?.TEAMS_CSV_URL);
        const gamesCsv = await fetchCsv(window.SHEET?.GAMES_CSV_URL);

        const teamRows = parseCsv(teamsCsv);
        const gameRows = parseCsv(gamesCsv);

        const recordMap = computeRecords(gameRows);

        renderTeams(teamRows, recordMap);

      } catch(err){
        console.error(err);
        alert("Teams page error: check TEAMS_CSV_URL and GAMES_CSV_URL.");
      }
    })();
  </script>
</body>
</html>







